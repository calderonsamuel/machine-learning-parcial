---
title: "machine-learning-parcial"
editor_options: 
  chunk_output_type: console
---


```{r}
library(tidyverse)
library(tidymodels)
```

## Read data

```{r}
suscripcion <- read_csv("data/train.csv") |> 
  mutate_if(is.character, as.factor)

validation <- read_csv("data/test_x.csv") |> 
  mutate_if(is.character, as.factor)
```

## Data splitting

```{r}
# We ignore this step for this new attempt

# # This enables the analysis to be reproducible when random numbers are used 
# set.seed(42)
# # Put 3/4 of the data into the training set 
# data_split <- initial_split(suscripcion, prop = 3/4)
# 
# # Create data frames for the two sets:
# train_data <- training(data_split)
# test_data  <- testing(data_split)
```

## Recipe

```{r}
my_recipe <- recipe(`Subscripcion Deposito` ~ ., data = suscripcion) |> 
  update_role(Id, Duracion, new_role = "ID") |> 
  step_dummy(all_nominal_predictors()) |> 
  step_zv(all_predictors())

my_recipe
```

## Model

```{r}
my_model <- logistic_reg() |> 
  set_engine("glm")
```

## Workflow

```{r}
my_workflow <- workflow() |> 
  add_model(my_model) |> 
  add_recipe(my_recipe)
```

## Fit

```{r}
suscripcion_fit <- my_workflow |> 
  fit(data = suscripcion)
```

```{r}
# suscripcion_fit |> 
#   extract_fit_parsnip() |> 
#   tidy()
```

```{r}
# suscripcion_fit |> 
#   augment(test_data) |> 
#   roc_curve(truth = `Subscripcion Deposito`, .pred_no) |> 
#   autoplot()
```

```{r}
# suscripcion_fit |> 
#   augment(test_data) |> 
#   roc_auc(truth = `Subscripcion Deposito`, .pred_no)
```

```{r}
resultados <- suscripcion_fit |> 
  augment(validation) |> 
  select(Id, `Subscripcion Deposito` = .pred_si)
```

```{r}
resultados |> 
  write_csv(format(now(), "results/r-%Y-%m-%d-%H-%M-%S.csv"))
```







